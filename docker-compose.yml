services:
  janus:
    build: 
      context: ./janus
    ports:
      - "8188:8188"  # WebSocket
      - "8088:8088"  # REST API
      - "6002:6002/udp"  # RTP port for video processor
      - "6001:6001/udp"  # RTCP port
      - "8004:8004/udp"  # RTP output port
      - "20000-20050:20000-20050/udp"  # Smaller WebRTC port range
    volumes:
      - ./janus/conf/janus.plugin.videoroom.jcfg:/usr/local/etc/janus/janus.plugin.videoroom.jcfg
      - ./janus/conf/janus.jcfg:/usr/local/etc/janus/janus.jcfg
    networks:
      - video_network

  video_processor:
    build:
      context: ./processor
    networks:
      - video_network  # Use Docker network instead of host
    depends_on:
      janus:
        condition: service_started
    restart: unless-stopped

networks:
  video_network:
    driver: bridge 